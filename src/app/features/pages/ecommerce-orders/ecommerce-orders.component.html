<div class="p-8 space-y-8">
  <header class="flex justify-between items-center">
    <div>
      <h1 class="text-3xl font-black text-primary tracking-tighter uppercase">Order Hub</h1>
      <p class="text-gray-500 font-medium">Managing e-commerce fulfillment across 11 branches</p>
    </div>

    <div class="flex bg-white p-1.5 rounded-2xl border border-border shadow-sm">
      <button
        (click)="setTab('paid')"
        [class]="activeTab() === 'paid' ? 'bg-primary text-white' : 'text-gray-400'"
        class="px-6 py-2 rounded-xl text-[10px] font-black uppercase transition-all"
      >
        New
      </button>
      <button
        (click)="setTab('processing')"
        [class]="activeTab() === 'processing' ? 'bg-primary text-white' : 'text-gray-400'"
        class="px-6 py-2 rounded-xl text-[10px] font-black uppercase transition-all"
      >
        Processing
      </button>
      <button
        (click)="setTab('shipped')"
        [class]="activeTab() === 'shipped' ? 'bg-primary text-white' : 'text-gray-400'"
        class="px-6 py-2 rounded-xl text-[10px] font-black uppercase transition-all"
      >
        Shipped
      </button>
    </div>
  </header>

  <div class="grid grid-cols-1 xl:grid-cols-2 gap-6">
    @for (order of orders(); track order.id) {
      <div
        class="bg-white rounded-[2.5rem] border border-border p-8 flex flex-col md:flex-row gap-6 hover:shadow-xl hover:shadow-primary/5 transition-all"
      >
        <div class="flex-1 space-y-4">
          <div class="flex justify-between items-start">
            <div>
              <p class="text-[10px] font-black text-primary uppercase tracking-widest">
                Order #{{ order.order_number }}
              </p>
              <h3 class="text-xl font-black text-gray-900 mt-1">{{ order.customer_name }}</h3>
            </div>
            <span class="px-3 py-1 bg-gray-100 rounded-full text-[10px] font-bold text-gray-500">{{
              order.created_at | date: 'shortTime'
            }}</span>
          </div>

          <div class="flex items-center gap-3 text-sm text-gray-500">
            <lucide-icon name="map-pin" class="w-4 h-4"></lucide-icon>
            <span class="font-medium"
              >Deliver to: <b class="text-gray-800">{{ order.shipping_city }}</b></span
            >
          </div>

          <div class="bg-gray-50 p-4 rounded-2xl">
            <p class="text-[10px] font-black text-gray-400 uppercase mb-2">Items</p>
            <ul class="space-y-1">
              @for (item of order.items; track item.id) {
                <li class="text-xs font-bold text-gray-700 flex justify-between">
                  <span>{{ item.quantity }}x {{ item.product.name }}</span>
                  <span>Rp {{ item.quantity * item.unit_price | number }}</span>
                </li>
              }
            </ul>
          </div>
        </div>

        <div class="md:max-w-48 border-l border-gray-100 md:pl-6 flex flex-col justify-between">
          <div *ngIf="order.branch">
            <label class="text-[10px] font-black text-gray-400 uppercase">Assigned Branch</label>
            <div
              class="mt-2 p-3 bg-primary/5 border border-primary/10 rounded-xl text-xs font-black text-primary text-center"
            >
              {{ order.branch.name }}
            </div>
          </div>

          <div class="space-y-2 mt-6">
            @if (activeTab() === 'paid') {
              <button (click)="processOrder(order.id)"
                      class="w-full py-3 bg-gray-900 text-white rounded-xl font-black text-[10px] uppercase shadow-lg hover:bg-primary transition-colors">
                Accept & Print Label
              </button>
            }

            @if (activeTab() === 'processing') {
              <button (click)="openShipmentModal(order)"
                      class="w-full py-3 bg-blue-600 text-white rounded-xl font-black text-[10px] uppercase shadow-lg shadow-blue-100 hover:bg-blue-700">
                <lucide-icon name="truck" class="w-3 h-3 inline mr-1"></lucide-icon>
                Input Resi & Ship
              </button>
            }

            @if (activeTab() === 'shipped') {
              <div class="p-3 bg-green-50 rounded-xl border border-green-100">
                <p class="text-[8px] font-black text-green-600 uppercase">Tracking Number</p>
                <p class="text-xs font-mono font-bold text-green-700">{{ order.tracking_number }}</p>
              </div>
            }

            <button
              routerLink="['/customers', order.customer_id]"
              class="w-full py-3 bg-white border border-border text-gray-500 rounded-xl font-black text-[10px] uppercase hover:bg-gray-50"
            >
              View Customer Profile
            </button>
          </div>
        </div>
      </div>
    } @empty {
      <div
        class="col-span-full py-20 bg-gray-50 rounded-[3rem] border-2 border-dashed border-gray-200 flex flex-col items-center justify-center text-gray-400"
      >
        <lucide-icon name="inbox" class="w-12 h-12 mb-4 opacity-20"></lucide-icon>
        <p class="font-bold">No orders in this queue.</p>
      </div>
    }
  </div>
</div>
